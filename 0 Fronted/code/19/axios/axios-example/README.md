## 封装axios方案



### 如何封装(添加功能)

* 在项目中引用方便, vue2中可以绑定到原型上, vue3可以
* 兼容REST封装,提供常用方法get/post/put/delete
* 统一入参, 统一处理错误, 统一返回格式
* 可取消重复请求, 用户切换路径取消请求
* 文件下载及上传
* 指定是否走mock服务,例如提供了本地strapi服务,则本地开发时仅使用proxy地址即可,也不用指定特别路径
* 

### 方案1

#### 封装思路

* 基础请求(get, post, put, del等请求的封装)
* 拦截器的封装
  * 请求拦截器: 请求头设置; 用户标识添加
  * 响应拦截器
    * 网络错误处理
    * 授权错误处理
    * 普通错误处理
    * 代码异常处理
* 取消请求
  * 取消请求的场景有哪些?
    * 页面切换
    * 搜索输入时的防抖节流: 快速输入时,需要取消上一次的搜索请求,只发送最后一次
    * 下拉列表的频繁切换
    * 用户手动取消操作: 用户点击取消按钮,关闭弹窗或放弃某个操作
    * 请求超时自动取消
    * 重复提交防止
    * 组件卸载时
    * 登录状态改变: 用户退出登录时取消所有未完成的请求
    * 依赖条件变更: 如使用React的useEffect时，依赖项变化导致之前的请求不再有效
    * 网络状态变化: 网络从在线变为离线
    * 无限滚动加载时切换条件: 比如用户在滚动加载时突然切换了筛选条件





